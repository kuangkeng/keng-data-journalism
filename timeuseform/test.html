<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Time Use Survey 2014</title>
  <link href='http://fonts.googleapis.com/css?family=Arimo:400,700|Roboto' rel='stylesheet' type='text/css'>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.12.0/jquery.validate.min.js"></script>
  <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
  <script src="d3-tipsy.js" charset="utf-8"></script>
  

  <style>
body {
  width:656px;
  font-family:'Arimo';
  font-size:15px;
  margin:20px auto;
  line-height: 22px;
  color: #212121;
  
      }  

h1{
  text-align: center;
  font-family: 'Roboto';
  font-size: 26px;
  line-height: 35px;
    }

h3, h2{
  text-align: center;
}

#barbox, #barbox2 {
  width:550px;
  margin: 0px auto;
  border:solid 1px black;
}

#instruction{
  font-size:13px;
  color:#8A8A8A;
  width:550px;
  margin: 0px auto;
}

input[type=text] {
 margin-top : 10px;
 margin-bottom : 10px;
}

#caution, #note {
  font-size:15px;
  color:#8A8A8A;
  margin-bottom : 10px;
}

#button {
 width: 100px;  
 font-size: 20px;
 float: right;
 margin-right:10%;
}

li.genderbox {
    list-style-type: none;
}

#reset {
 font-size: 20px;
 }

#bottomform, #sharebox {
  width: 300px;
  margin: 0 auto;
  text-align: center;
}

#about, #note{
  margin: 0 auto;
  width:550px;
}

a {
  text-decoration:underline;
}
 
.more {
  background-color: #FF9009;
  color:white;
  border-radius: 3px;
  padding:2px 5px 2px 5px;
  font-weight: normal;
  font-size:16px;
}


.less {
  background-color: #0C78B8;
  color:white;
  border-radius: 3px;
  padding:2px 5px 2px 5px;
  font-weight: normal;
  font-size:16px;
}

#sleepboxmore, #sleepboxless, #workboxmore, #workboxless, #shopboxmore, #shopboxless, #tvboxmore, #tvboxless, #videoboxmore, #videoboxless, #sportsboxmore, #sportsboxless 
{
  font-weight: 700;
}

.errormessage{
  padding: 0px 0px 0px 5px;
  width:220px;
  font-size:small;
  color:black;
  background-color: #FFDDDD;
  }

.bar.positive {
  fill: #FF9009;
}

.bar.negative {
  fill: #0C78B8;
}

.axis text {
  font: 10px 'Arimo';
}

.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

/* Style for the tooltip starts from here */

.d3-tip {
  padding: 10px;
  background: rgba(0, 0, 0, 0.6);
  color: #fff;
  border-radius: 2px;
  font-family:'Arimo';
  font-size: 14px;
}

/* Creates a small triangle extender for the tooltip */
.d3-tip:after {
  box-sizing: border-box;
  display: inline;
  font-size: 15px;
  width: 100%;
  line-height: 1;
  color: rgba(0, 0, 0, 0.6);
  content: "\25BC";
  position: absolute;
  text-align: center;
}

/* Style northward tooltips differently */
.d3-tip.n:after {
  margin: -1px 0 0 0;
  top: 100%;
  left: 0;
}

  </style>
</head>
<body>
 
<h1>Do you sleep, work and play more than fellow Americans?</h1>
<br>
<hr width="100%" size="2" noshade="noshade" color="#8A8A8A"/>
<br>
<div id="caution">*Please provide your answer in fraction of an hour, e.g., 1.5 (1 hour and 30 minutes), 7.25 (7 hours and 15 minutes), 2.75 (2 hours and 45 minutes).</div><br>
<form name="myForm" id="timeuseform" method="get" action="#">
<ol>
<li>
How many hours do you typically sleep a night?<br>
<input type="text" name="sleep" value="" id="inputsleep"/><br>
<div id="sleepboxmore">Stop hitting that snooze button! You sleep <span id="sleepnomore"></span> than the average American who sleeps <span id="sleepavgnomore"></span> hours.</div>
<div id="sleepboxless">Go back to bed! You sleep <span id="sleepnoless"></span> than the average American, who sleeps <span id="sleepavgnoless"></span> hours.</div><br><br>
</li>
<li>
How many hours do you spend on the job during the average workday? Don’t count commute time.<br>
<input type="text" name="work" value="" id="inputwork"/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Employment status
<SELECT NAME="workstatus" SIZE="1" id="inputworkstatus">
<OPTION>full-time</option>
<OPTION>part-time</option>
</SELECT><br>
<div id="workboxmore">Clock out already! You work <span id="worknomore"></span> than the average <span id="workgendermore"></span> American with a <span id="workstatusmore"></span> job, who works <span id="workavgnomore"></span> hours. The figure among general American population is 7.58 hours.</div>
<div id="workboxless">Time to get back to work! You work <span id="worknoless"></span> than the average <span id="workgenderless"></span> American with a <span id="workstatusless"></span> job, who works <span id="workavgnoless"></span> hours. The figure among general American population is 7.58 hours.</div><br><br>
<li>
How much time you spend shopping per day, either in person, on the phone, online or at a store?<br>
<input type="text" name="shop" value="" id="inputshop"/><br>
<div id="shopboxmore">Put away that credit card! You shop <span id="shopnomore"></span> than the average <span id="shopgendermore"></span> American age <span id="shopagemore">%</span>, who shops <span id="shopavgnomore"></span> hours. The figure among general American population is 0.75 hours.</div>
<div id="shopboxless">Get your wallet out! You shop <span id="shopnoless"></span> than the average <span id="shopgenderless"></span> American age <span id="shopageless"></span>, who shops <span id="shopavgnoless"></span> hours. The figure among general American population is 0.75 hours.</div><br><br>
</li>
<li>
How much time you spend watching TV on a weekend day?<br>
<input type="text" name="tv" value="" id="inputtv"/><br>
<div id="tvboxmore">Step away from the flat-screen! You watch <span id="tvnomore"></span> TV than the average American age <span id="tvagemore"></span>, who watches <span id="tvavgnomore"></span> hours each weekend day. The figure among general American population is 3.24 hours.</div>
<div id="tvboxless">Grab that remote! You watch <span id="tvnoless"></span> TV than the average American age <span id="tvageless"></span>, who watches <span id="tvavgnoless"></span> hours each weekend day. The figure among general American population is 3.24 hours.</div><br><br>
</li>
<li>
How long do you spend playing video games and using computers for leisure, such as browsing the Internet or checking Facebook, on a typical weekend day?<br>
<input type="text" name="video" value="" id="inputvideo"/><br>
<div id="videoboxmore">Log off and put the game console away! You spend <span id="videonomore"></span> time on these activities than the average American age <span id="videoagemore"></span>, who spends <span id="videoavgnomore"></span> hours. The figure among general American population is 0.48 hours.</div>
<div id="videoboxless">Go ahead, start that YouTube binge! You spend <span id="videonoless"></span> time on these activities than the average American age <span id="videoageless"></span> who spends <span id="videoavgnoless"></span> hours. The figure among general American population is 0.48 hours.</div><br><br>
</li>
<li>
How much time you spend on sports, exercise and recreation on a weekend day?<br>
<input type="text" name="sports" value="" id="inputsports"/><br>
<div id="sportsboxmore">Give those muscles a break! You workout <span id="sportsnomore"></span> than the average American age <span id="sportsagemore"></span>, who spends <span id="sportsavgnomore"></span> hours breaking a sweat. The figure among general American population is 0.36 hours.</div>
<div id="sportsboxless">Better hit the gym! You workout <span id="sportsnoless"></span> than the average American age <span id="sportsageless"></span>, who spends <span id="sportsavgnoless"></span> hours breaking a sweat. The figure among general American population is 0.36 hours.</div><br><br>
</li>
<li class="genderbox">Gender
<SELECT name="gender" SIZE="1" id="inputgender">
<OPTION>male</option>
<OPTION>female</option>
</SELECT>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Age range
<SELECT name="age" SIZE="1" id="inputage">
<OPTION>15 to 19</option>
<OPTION>20 to 24</option>
<OPTION>25 to 34</option>
<OPTION>35 to 44</option>
<OPTION>45 to 54</option>
<OPTION>55 to 64</option>
<OPTION>65 to 74</option>
<OPTION>75 and above</option>
</SELECT>
</li>
<br><br>
</ol>

<input type="submit" value="Submit" id="button"/>

</form>

<br>
<div id="result">
<h3 id="bartitle">Your results compared with Americans of your gender, age group and employment status</h3>
<div id="instruction">Hover over the bars to see which group is being compared and their average time use</div>
<div id="barbox"></div>
<br><br>
<h3 id="bartitle2">Your results compared with general American population</h3>
<div id="instruction">Hover over the bars to see the average time use</div>
<div id="barbox2"></div>
<br><br>

<FORM id="bottomform">
<INPUT TYPE="button" onClick="history.go(0)" VALUE="Take the quiz again" id="reset">
</FORM>

<div id="sharebox">
<p>or</p>
<h3>Share your results</h3>
<a href="http://twitter.com/share"
    class="twitter-share-button"
    data-text="This is what we want to change dynamically"
    data-count="vertical" data-via="kuangkeng">Tweet</a>
</div>

</div>
<br><br><br>
<div id="note">
<span style="font-weight:bold; font-size:14px">Note:</span>
<p>Employment status: Full-time workers are those who usually worked 35 hours or more per week at all jobs combined. Part-time workers are those who usually worked fewer than 35 hours per week at all jobs combined.</p>
<p>Comparison of time use according to categories - gender, age group and employment status - is carried out based on how the ATUS data is categorized. E.g., the data of work time is not categorized by age groups, while the data of time use on watching TV, playing games and computer use for leisure, and sports, exercise and recreation, is not categorized by age within gender.</p>
</div>
<br>
<hr width="100%" size="2" noshade="noshade" color="#8A8A8A"/>
<br>
<div id="about">
<h2>About American Time Use Survey 2013</h2>

<p>The results of from the <a href="http://www.bls.gov/news.release/atus.nr0.htm" target="_blank"> American Time Use Survey (ATUS) 2013</a> was released on June 18. The annually released survey conducted by the U.S. Census Bureau for the Bureau of Labor Statistics (BLS) is a continuous study about how civilians age 15 and over spend their time. These data include the average amount of time per day in 2013 that individuals worked, did household activities, and engaged in leisure and sports activities.</p>

<p>The survey found that on average employed men (7.97 hours) worked 53 minutes more than employed women (7.08 hours) on workday, partly due to women's greater likelihood of working part time. However, among full time workers, men (8.34 hours) also worked 37 minutes longer than women (7.73 hours).</p>

<p>Watching TV was the top leisure activity among Americans who watch an average of 2.77 hours per day or 3.24 hours on weekend day. Men (2.98 hours) watched 25 minutes more TV than women (2.57 hours) per day.</p>

<p>Men were more likely than women to participate in sports, exercise, or recreation on any given day - 21 percent compared with 16 percent. On the days that they participated, men also spent 40 minutes more in these activities than women – 1.9 hours compared with 1.24 hours.</p>

<p>Time spent playing games or using a computer for leisure varied greatly by age. Individuals in the age groups of 15 – 19 and 20 – 24, spent 52 and 56 minutes respectively on the activity on weekend day, the highest among all age groups. The average time across all ages was 29 minutes.</p>

<p>The Wall Street Journal has published a <a href="http://online.wsj.com/articles/aging-americans-sleep-more-work-less-survey-finds-1403121530" target="_blank">report</a> comparing the survey results with historical data.
</div><br>

<script>
$("#message, #workboxmore, #workboxless, #sleepboxmore, #sleepboxless, #shopboxmore, #shopboxless, #tvboxmore, #tvboxless, #videoboxmore, #videoboxless, #sportsboxmore, #sportsboxless, #result").hide();

var dataavg = {sleep: 8.74, work: 7.58, shop: 0.75, tv: 3.24, sports: 0.36, video: 0.48};

var avgsleep = 8.74;

var datawork = [
{"gender":"male","fulltime":8.34,"parttime":5.42},
{"gender":"female","fulltime":7.73,"parttime":5.29}];

var dataleisure = [
{"age":"15-19","tv":2.76,"sports":0.76,"video":0.87},
{"age":"20-24","tv":2.49,"sports":0.38,"video":0.93},
{"age":"25-34","tv":2.72,"sports":0.34,"video":0.48},
{"age":"35-44","tv":2.95,"sports":0.38,"video":0.35},
{"age":"45-54","tv":3.14,"sports":0.28,"video":0.31},
{"age":"55-64","tv":3.57,"sports":0.37,"video":0.39},
{"age":"65-74","tv":4.51,"sports":0.27,"video":0.55},
{"age":"75over","tv":4.19,"sports":0.16,"video":0.34}];

var datashop = [
{"age":"15-19","male":0.44,"female":0.56},
{"age":"20-24","male":0.44,"female":0.83},
{"age":"25-34","male":0.64,"female":0.88},
{"age":"35-44","male":0.66,"female":0.87},
{"age":"45-54","male":0.64,"female":0.88},
{"age":"55-64","male":0.65,"female":0.9},
{"age":"65-74","male":0.71,"female":0.92},
{"age":"75over","male":0.82,"female":0.91}];

$(document).ready(function(){

//form validation using jquery validation plugin
   $("#timeuseform").validate({
    rules: {
          sleep: {
            required: true,
            range: [0,24]
          },
          work: {
            required: true,
            range: [0,24]
          },
          shop: {
            required: true,
            range: [0,24]
          },
          tv: {
            required: true,
            range: [0,24]
          },
          video: {
            required: true,
            range: [0,24]
          },
          sports: {
            required: true,
            range: [0,24]
          }
        },
//messages to be displayed if input cannot be validated
    messages: {
                    sleep: {
                        required: "Please answer this question",
                        range: "Must be a number between 0 and 24 with maximum 2 decimal places"
                    },
                    work: {
                        required: "Please answer this question",
                        range: "Must be a number between 0 and 24 with maximum 2 decimal places"
                    },
                    shop: {
                        required: "Please answer this question",
                        range: "Must be a number between 0 and 24 with maximum 2 decimal places"
                    },
                    tv: {
                        required: "Please answer this question",
                        range: "Must be a number between 0 and 24 with maximum 2 decimal places"
                    },
                    video: {
                        required: "Please answer this question",
                        range: "Must be a number between 0 and 24 with maximum 2 decimal places"
                    },
                    sports: {
                        required: "Please answer this question",
                        range: "Must be a number between 0 and 24 with maximum 2 decimal places"
                    }
                },

//display error messages style if input cannot be validated
       errorPlacement: function(error, element) {
 //       error.insertAfter(element);
        offset = element.offset();
            error.insertAfter(element)
            error.addClass('errormessage');  // add a class to the wrapper
        error.css('position', 'absolute');
            error.css('left', offset.left);
            error.css('top', offset.top + element.outerHeight() + 5);
    },
    wrapper: 'div',         

submitHandler: function(form) {

//setting the input variables
    var inputsleep = $('#inputsleep').val(),
      inputwork = $('#inputwork').val(),
      inputshop = $('#inputshop').val(),
      inputtv = $('#inputtv').val(),
      inputvideo = $('#inputvideo').val(),
      inputsports = $('#inputsports').val(),
      inputage = $('#inputage').val(),
      inputgender = $('#inputgender').val(),
      inputworkstatus = $('#inputworkstatus').val();

//setting the age groups variables

    if(inputage=="15 to 19"){var age=0;}
    if(inputage=="20 to 24"){var age=1;}
    if(inputage=="25 to 34"){var age=2;}
    if(inputage=="35 to 44"){var age=3;}
    if(inputage=="45 to 54"){var age=4;}
    if(inputage=="55 to 64"){var age=5;}
    if(inputage=="65 to 74"){var age=6;}
    if(inputage=="75 and above"){var age=7;}

//setting the gender groups variables
    if(inputgender=="male"){var gender=0;}
    if(inputgender=="female"){var gender=1;}
    if(inputgender=="male"){var shopgender="male";}
    if(inputgender=="female"){var shopgender="female";}

//setting the workstatus groups variables
    if(inputworkstatus=="full-time"){var workstatus="fulltime";}
    if(inputworkstatus=="part-time"){var workstatus="parttime";}

//setting the average variables which are based on users' input
    var avgwork = datawork[gender][workstatus],
      avgshop = datashop[age][shopgender],
      avgtv = dataleisure[age].tv,
      avgvideo = dataleisure[age].video,
      avgsports = dataleisure[age].sports;


//code for question 1 on sleep

    var sleepfull = (inputsleep - avgsleep) / avgsleep *100,
      sleep = Math.round(sleepfull),
      sleepabs = Math.abs(sleep);
    if(sleep>0){
      $("#sleepboxmore").show();
      $("#sleepnomore").text(sleepabs+"% more");
      $("#sleepavgnomore").text(avgsleep);
      $("#sleepnomore").addClass("more");
    }
    else{
      $("#sleepboxless").show();
      $("#sleepnoless").text(sleepabs+"% less");
      $("#sleepavgnoless").text(avgsleep);
      $("#sleepnoless").addClass("less");
    }
    console.log("question 1 answer: " + sleepabs);

//code for question 2 on work
    var workfull = (inputwork - avgwork)/avgwork *100,
      work = Math.round(workfull),
      workabs = Math.abs(work);
      if(work>0){
        $("#workboxmore").show();
        $("#worknomore").text(workabs+"% more");
        $("#workavgnomore").text(avgwork);
        $("#workgendermore").text(inputgender);
        $("#workstatusmore").text(inputworkstatus);
        $("#worknomore").addClass("more");
      }
      else{
        $("#workboxless").show();
        $("#worknoless").text(workabs+"% less");
        $("#workavgnoless").text(avgwork);
        $("#workgenderless").text(inputgender);
        $("#workstatusless").text(inputworkstatus);
        $("#worknoless").addClass("less");
      }
      console.log("question 2 answer: " + workabs);

//code for question 3 on shopping
  var shopfull = (inputshop - avgshop)/avgshop *100,
    shop = Math.round(shopfull),
    shopabs = Math.abs(shop);
    if(shop>0){
      $("#shopboxmore").show();
      $("#shopnomore").text(shopabs+"% more");
      $("#shopavgnomore").text(avgshop);
      $("#shopgendermore").text(inputgender);
      $("#shopagemore").text(inputage);
      $("#shopnomore").addClass("more");
    }
    else{
      $("#shopboxless").show();
      $("#shopnoless").text(shopabs+"% less");
      $("#shopavgnoless").text(avgshop);
      $("#shopgenderless").text(inputgender);
      $("#shopageless").text(inputage);
      $("#shopnoless").addClass("less");
    }
    console.log("question 3 answer: " + shopabs);
    

//code for question 4 on tv

  var tvfull = (inputtv - avgtv)/ avgtv *100,
    tv = Math.round(tvfull),
    tvabs = Math.abs(tv);
  if(tv>0){
    $("#tvboxmore").show();
    $("#tvnomore").text(tvabs+"% more");
    $("#tvavgnomore").text(avgtv);
    $("#tvagemore").text(inputage);
    $("#tvnomore").addClass("more");
    }
  else{
    $("#tvboxless").show();
    $("#tvnoless").text(tvabs+"% less");
    $("#tvavgnoless").text(avgtv);
    $("#tvageless").text(inputage);
    $("#tvnoless").addClass("less");
    }
  console.log("question 4 answer: " + tvabs);

//code for question 5 on video games and computer

  var videofull = (inputvideo - avgvideo)/ avgvideo *100,
    video = Math.round(videofull),
    videoabs = Math.abs(video);
  if(video>0){
    $("#videoboxmore").show();
    $("#videonomore").text(videoabs+"% more");
    $("#videoavgnomore").text(avgvideo);
    $("#videoagemore").text(inputage);
    $("#videonomore").addClass("more");
    }
  else{
    $("#videoboxless").show();
    $("#videonoless").text(videoabs+"% less");
    $("#videoavgnoless").text(avgvideo);
    $("#videoageless").text(inputage);
    $("#videonoless").addClass("less");
    }
  console.log("question 5 answer: " + videoabs);

//code for question 6 on sports, exercise and recreation

  var sportsfull = (inputsports - avgsports)/ avgsports *100,
    sports = Math.round(sportsfull),
    sportsabs = Math.abs(sports);
  if(sports>0){
    $("#sportsboxmore").show();
    $("#sportsnomore").text(sportsabs+"% more");
    $("#sportsavgnomore").text(avgsports);
    $("#sportsagemore").text(inputage);
    $("#sportsnomore").addClass("more");
    }
  else{
    $("#sportsboxless").show();
    $("#sportsnoless").text(sportsabs+"% less");
    $("#sportsavgnoless").text(avgsports);
    $("#sportsageless").text(inputage);
    $("#sportsnoless").addClass("less");
    }
  console.log("question 6 answer: " + sportsabs);

//create a new array based on calculation of input (convert to percentage)

  var dataset = [
    {"name":"Sleep","value": sleep/100, "label": sleep, "tooltip": "Compared with average Americans" + " (" +avgsleep+" hours)"},
    {"name":"Work","value": work/100, "label": work, "tooltip": "Compared with " + inputgender + " Americans with " + inputworkstatus + " employment" + " (" +avgwork+" hours)"},
    {"name":"Shop","value": shop/100, "label": shop, "tooltip": "Compared with " + inputgender + " Americans aged " + inputage + " (" +avgshop+" hours)"},
    {"name":"Watch TV","value": tv/100, "label": tv, "tooltip": "Compared with Americans aged " + inputage + " (" +avgtv+" hours)"},
    {"name":"Computer","value": video/100, "label": video, "tooltip": "Compared with Americans aged " + inputage + " (" +avgvideo+" hours)"},
    {"name":"Workout","value": sports/100, "label": sports, "tooltip": "Compared with Americans aged " + inputage + " (" +avgsports+" hours)"}
    ];
  console.log (dataset[1].value);
  
//code for first d3 bar chart starts here 

var margin = {top: 30, right: 50, bottom: 10, left: 140},
    width = 540 - margin.left - margin.right,
    height = 400 - margin.top - margin.bottom;

var x = d3.scale.linear()
    .range([0, width])

var y = d3.scale.ordinal()
    .rangeRoundBands([0, height], .2);

var formatAsPercentage = d3.format("10%");

var xAxis = d3.svg.axis()
    .scale(x)
    .tickFormat(formatAsPercentage)
    .ticks(10)
    .orient("top");

var tip = d3.tip()
  .attr('class', 'd3-tip')
  .offset([-10, 0])
  .html(function(d) {return d.tooltip;});

var svg = d3.select("#barbox").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

svg.call(tip);

  x.domain(d3.extent(dataset, function(d) { return d.value; })).nice();
  y.domain(dataset.map(function(d) { return d.name; }));

var xd = x.domain(d3.extent(dataset, function(d) { return d.value; })).nice(),
    yd = y.domain(dataset.map(function(d) { return d.name; }));


  svg.selectAll(".bar")
      .data(dataset)
      .enter().append("rect")
      .attr("class", function(d) { return d.value < 0 ? "bar negative" : "bar positive"; })
      .attr("x", function(d) { return x(Math.min(0, d.value)); })
      .attr("y", function(d) { return y(d.name); })
      .attr("width", function(d) { return Math.abs(x(d.value) - x(0)); })
      .attr("height", y.rangeBand())
      .on('mouseover', tip.show)
      .on('mouseout', tip.hide);

  svg.append("g")
      .attr("class", "y axis")
      .append("line")
      .attr("x1", x(0))
      .attr("x2", x(0))
      .attr("y2", height);

  svg.append("g")
      .attr("class", "x axis")
      .call(xAxis);

svg.selectAll("text.name")
  .data(dataset)
  .enter()
  .append("text")
  .text(function(d){return d.name;})
  .attr("y", function(d) { return y(d.name)+ y.rangeBand()/2; })
  .attr("x", -50)
  .attr('stroke', 'none')
  .attr('fill', 'black')
  .attr("dy", ".35em")
  .attr('text-anchor', 'end')
  .attr({"fill":"black","font-family":"Arimo", "font-size":15});
  

  svg.selectAll("text.value")
     .data(dataset)
     .enter()
     .append("text")
     .text(function(d){return d.label + "%";})
     .attr("x", function(d) { 
        if (d.value <= 0) {
          return x(Math.min(0, d.value));
        }
        else {
          return x(Math.min(0, d.value)) + Math.abs(x(d.value)-x(0));
        }
        })
     .attr("y", function(d) { return y(d.name)+ y.rangeBand()/2; })
     .attr("text-anchor", function(d){
      if (d.value <= 0) {return "end"}
      else {return "left"}
     })
     .attr("dx", function(d){
      if (d.value <= 0) {return -2}
      else {return 2}
     })
     .attr("dy", ".36em")
     .attr({"fill":"black","font-family":"Arimo", "font-size":14});
  
function type(d) {
  d.value = +d.value;
  return d;}

//create a new array based on calculation of population average values

var sleepfull2 = (inputsleep - dataavg.sleep)/dataavg.sleep *100,
  sleep2 = Math.round(sleepfull2);
var workfull2 = (inputwork - dataavg.work)/dataavg.work *100,
  work2 = Math.round(workfull2);
var shopfull2 = (inputshop - dataavg.shop)/dataavg.shop *100,
  shop2 = Math.round(shopfull2);
var tvfull2 = (inputtv - dataavg.tv)/dataavg.tv *100,
  tv2 = Math.round(tvfull2);
var videofull2 = (inputvideo - dataavg.video)/dataavg.video *100,
  video2 = Math.round(videofull2);
var sportsfull2 = (inputsports - dataavg.sports)/dataavg.sports *100,
  sports2 = Math.round(sportsfull2);

var dataset2 = [
  {"name":"Sleep","value": sleep2/100, "label": sleep2, "tooltip": "Compared with general Americans" + " (" +dataavg.sleep+" hours)"},
  {"name":"Work","value": work2/100, "label": work2, "tooltip": "Compared with general Americans" + " (" +dataavg.work+" hours)"},
  {"name":"Shop","value": shop2/100, "label": shop2, "tooltip": "Compared with general Americans" + " (" +dataavg.shop+" hours)"},
  {"name":"Watch TV","value": tv2/100, "label": tv2, "tooltip": "Compared with general Americans" + " (" +dataavg.tv+" hours)"},
  {"name":"Computer","value": video2/100, "label": video2, "tooltip": "Compared with general Americans" + " (" +dataavg.video+" hours)"},
  {"name":"Workout","value": sports2/100, "label": sports2, "tooltip": "Compared with general Americans" + " (" +dataavg.sports+" hours)"}];

//code for second d3 bar using dataset2:

var margin = {top: 30, right: 50, bottom: 10, left: 140},
    width = 540 - margin.left - margin.right,
    height = 400 - margin.top - margin.bottom;

var x = d3.scale.linear()
    .range([0, width])

var y = d3.scale.ordinal()
    .rangeRoundBands([0, height], .2);

var formatAsPercentage = d3.format("10%");

var xAxis = d3.svg.axis()
    .scale(x)
    .tickFormat(formatAsPercentage)
    .ticks(10)
    .orient("top");

var tip = d3.tip()
    .attr('class', 'd3-tip')
    .offset([-10, 0])
    .html(function(d) {return d.tooltip;});

var svg = d3.select("#barbox2").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

svg.call(tip);

  x.domain(d3.extent(dataset2, function(d) { return d.value; })).nice();
  y.domain(dataset2.map(function(d) { return d.name; }));

var xd = x.domain(d3.extent(dataset2, function(d) { return d.value; })).nice(),
    yd = y.domain(dataset2.map(function(d) { return d.name; }));


  svg.selectAll(".bar")
      .data(dataset2)
      .enter().append("rect")
      .attr("class", function(d) { return d.value < 0 ? "bar negative" : "bar positive"; })
      .attr("x", function(d) { return x(Math.min(0, d.value)); })
      .attr("y", function(d) { return y(d.name); })
      .attr("width", function(d) { return Math.abs(x(d.value) - x(0)); })
      .attr("height", y.rangeBand())
      .on('mouseover', tip.show)
      .on('mouseout', tip.hide);

  svg.append("g")
      .attr("class", "y axis")
      .append("line")
      .attr("x1", x(0))
      .attr("x2", x(0))
      .attr("y2", height);

  svg.append("g")
      .attr("class", "x axis")
      .call(xAxis);

svg.selectAll("text.name")
  .data(dataset2)
  .enter()
  .append("text")
  .text(function(d){return d.name;})
  .attr("y", function(d) { return y(d.name)+ y.rangeBand()/2; })
  .attr("x", -50)
  .attr('stroke', 'none')
  .attr('fill', 'black')
  .attr("dy", ".35em")
  .attr('text-anchor', 'end')
  .attr({"fill":"black","font-family":"Arimo", "font-size":15});
  

  svg.selectAll("text.value")
     .data(dataset2)
     .enter()
     .append("text")
     .text(function(d){return d.label + "%";})
     .attr("x", function(d) { 
        if (d.value <= 0) {
          return x(Math.min(0, d.value));
        }
        else {
          return x(Math.min(0, d.value)) + Math.abs(x(d.value)-x(0));
        }
        })
     .attr("y", function(d) { return y(d.name)+ y.rangeBand()/2; })
     .attr("text-anchor", function(d){
      if (d.value <= 0) {return "end"}
      else {return "left"}
     })
     .attr("dx", function(d){
      if (d.value <= 0) {return -2}
      else {return 2}
     })
     .attr("dy", ".36em")
     .attr({"fill":"black","font-family":"Arimo", "font-size":14});
  
function type(d) {
  d.value = +d.value;
  return d;}

$("#message, #result").show();
$("#button").hide();

//code for dynamic twitter message

var twittermsg;
if(sleep>0&&work>0){twittermsg="I sleep and work more than fellow Americans. What about you?";}
if(sleep>0&&work<0){twittermsg="I sleep more and work less than fellow Americans. What about you?";}
if(sleep<0&&work>0){twittermsg="I work more and sleep less than fellow Americans. What about you?";}
if(sleep<0&&work<0){twittermsg="I sleep and work less than fellow Americans. What about you?";}
else{"Do you sleep, work and play more than fellow Americans?";}

console.log(twittermsg);

$('a[data-text]').each(function(){
    $(this).attr('data-text', twittermsg);
    });
$.getScript('http://platform.twitter.com/widgets.js');

   }


});


});
</script>

<iframe width="660" height="3800" frameborder="0" class="survey" src="http://kuangkeng.github.io/keng-data-journalism/timeuseform/indexd3.html" allowfullscreen=""></iframe>


</body>
</html>